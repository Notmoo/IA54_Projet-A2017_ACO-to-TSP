package com.utbm.ia54.aco

import io.sarl.core.Initialize
import io.sarl.core.Destroy
import io.sarl.core.DefaultContextInteractions
import java.util.UUID
import java.util.Random
import io.sarl.core.Logging
import com.utbm.ia54.aco.AntCreated
import io.sarl.core.Behaviors
import com.utbm.ia54.aco.ClassicTSPWorker
import com.utbm.ia54.aco.TWTSPWorker
import com.utbm.ia54.aco.ApplicationClose
import com.utbm.ia54.aco.ImportanceFactorChanged
import com.utbm.ia54.aco.KillAnts
import com.utbm.ia54.aco.AntKilled

//-----------------------------------------
//		AGENTS
//-----------------------------------------
agent AntAgent{
	uses Logging, DefaultContextInteractions, TSPPathFinder
	
	var envUUID : UUID
	
	on Initialize {
		if (!occurrence.parameters.isEmpty) {
			var numAnt = occurrence.parameters.get(0) as Integer
			loggingName = "Ant_" + numAnt.toString
			
			var pheromoneImportanceFactor = -1 as float
			var distanceImportanceFactor = -1 as float
			
			if(occurrence.parameters.size>3){
				currTspVersionNb = occurrence.parameters.get(1) as Integer
				pheromoneImportanceFactor = occurrence.parameters.get(2) as Float
				distanceImportanceFactor = occurrence.parameters.get(3) as Float
				
			}else{
				currTspVersionNb = 0
			}
				
			switch (currTspVersionNb){
				case 2: new TWTSPWorker(this).registerBehavior
				default: new ClassicTSPWorker(this).registerBehavior
			}
			
			new ImportanceFactorChanged(distanceImportanceFactor, pheromoneImportanceFactor).emit[it.UUID === this.ID]
			new AntCreated().emit
		}else{
			killMe
		}
		
		// TODO ajouter un else pour le cas o√π l'init est mal faite
		
		new SimpleTSPPathFinder().setSkill(TSPPathFinder)
		new AntCreated().emit
	}
	
	on Destroy {
		new AntKilled()
	}
	
	on KillAnts{
		killMe
	}
	
	on ApplicationClose {
		killMe
	}
}